$def with (link, form, preview)

$ here = "link/%s" % link.linkID

$ date = model.to_datestr(link.timestamp)
<h2>
  <a href="/daily/$model.to_date_link(link.timestamp)">$date</a>
</h2>

<p class="meta">
  <a href="$here/hide">${ "Hidden" if link.hidden else "Showing" }</a> |
  <a href="$here/close">${ "Closed" if link.closed else "Open for comments" }</a>
</p>

$if not link.URL:
    <b>$link.title</b>
$else:
    <a href="$link.URL">$:link.URL_description</a>
$:link.description
$if link.extended:
    <p>$:link.extended
<p>
$ user = model.get_user(link.userID)
posted by <a href="user/$user.username">$user.username</a>
$model.ago(link.timestamp) ago

$ comments = model.get_comments(link.linkID)

$for comment in comments:
    <p>
    $:comment.content
    <p>
    $ user = model.get_user(comment.userID)
    posted by <a href="user/$user.username">$user.username</a>
    $model.ago(comment.timestamp) ago
    $ likes = model.get_likes(comment.commentID)
    | $len(likes) likes
    | <a href="comment/$comment.commentID/like">I like it</a>
    $if model.is_admin():
        | <a href="comment/$comment.commentID/delete">Delete</a>
    <hr/>

$if not link.closed:
    $if form:
        $if preview != None:
            <p class="preview">$:preview
        <p>
        <form name="main" method="post"> 
	  $:form.render()
	  <input type="submit" name="post" value="Post"/>
	  <input type="submit" name="preview" value="Preview"/>
	</form>
    $else:
        <p><a href="/link/$link.linkID/new">New comment</a>
