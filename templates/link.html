$def with (link, form, preview)

$ here = "link/%s" % link.linkID

$ date = link.to_datestr()
<h2 class="entry-title">
  <a href="daily/$link.to_date_link()">$date</a>
</h2>

$if model.is_admin():
  <p class="meta">
    <a href="$here/hide">${ "Hidden" if link.hidden else "Showing" }</a> |
    <a href="$here/close">${ "Closed" if link.closed else "Open for comments" }</a>
  </p>

$if not link.URL:
    <b>$link.title</b>
$else:
    <a href="$link.URL">$:link.URL_description</a>
$:link.description
$if link.extended:
    <p>$:link.extended
<p class="byline">
$ user = link.user
posted by <a href="user/$user.username">$user.username</a>
$link.ago() ago

$ comments = link.comments

<ul class="commentlist">
$for comment in comments:
    <li>
    <div class="comment">
    $:comment.content
    <footer>
    $ user = comment.user
    posted by <a href="user/$user.username">$user.username</a>
    $link.ago() ago
    $if features.likes:
        $ likes = comment.likes
        | $len(likes) likes
        | <a href="comment/$comment.commentID/like">I like it</a>
    $if model.is_admin():
        | <a href="comment/$comment.commentID/delete">Delete</a>
    </footer>
    </div>
</ul>

$if not link.closed:
    $if form:
        <a id="comment"></a>
        $if preview != None:
            <p class="preview">$:preview
        <div id="commentform">
        <form name="main" method="post"> 
	  $:form.render()
	  <input type="submit" name="post" value="Post"/>
	  <input type="submit" name="preview" value="Preview"/>
	</form>
        </div>
    $else:
        <p><a href="/link/$link.linkID/new#comment">New comment</a>
